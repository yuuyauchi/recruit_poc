# SkillLens 実装関数リファレンス

## 📊 関数一覧（全31関数）

### 出力タイプの分類
- 🔷 **単一セル出力**: 結果が1つのセルに表示される
- 🔶 **複数セル出力**: 結果が複数セルにまたがる（現在の実装では文字列化して単一セルに表示）

---

## 1. 数値計算関数

### SUM 🔷
**説明**: 数値の合計を計算
**構文**: `=SUM(数値1, 数値2, ...)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=SUM(100, 200, 300)
```
**出力結果**:
```
600
```

**範囲での使用例**:
```excel
=SUM(A1:A10)
```
**出力結果**: A1～A10の合計値（例: `5500`）

---

### AVERAGE 🔷
**説明**: 数値の平均を計算
**構文**: `=AVERAGE(数値1, 数値2, ...)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=AVERAGE(80, 90, 100)
```
**出力結果**:
```
90
```

**範囲での使用例**:
```excel
=AVERAGE(B2:B10)
```
**出力結果**: B2～B10の平均値（例: `85.5`）

---

### COUNT 🔷
**説明**: 数値が含まれるセルの個数をカウント
**構文**: `=COUNT(値1, 値2, ...)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=COUNT(10, 20, "テキスト", 30, "", 40)
```
**出力結果**:
```
4
```
（数値: 10, 20, 30, 40 の4個）

---

### MAX 🔷
**説明**: 最大値を返す
**構文**: `=MAX(数値1, 数値2, ...)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=MAX(50, 120, 75, 200, 30)
```
**出力結果**:
```
200
```

---

### MIN 🔷
**説明**: 最小値を返す
**構文**: `=MIN(数値1, 数値2, ...)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=MIN(50, 120, 75, 200, 30)
```
**出力結果**:
```
30
```

---

### ROUND 🔷
**説明**: 数値を指定した桁数に四捨五入
**構文**: `=ROUND(数値, 桁数)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=ROUND(123.456, 2)
```
**出力結果**:
```
123.46
```

**桁数の意味**:
- `2`: 小数点第2位まで → `123.46`
- `0`: 整数 → `123`
- `-1`: 十の位で四捨五入 → `120`

---

## 2. 条件判定・論理関数

### IF 🔷
**説明**: 条件によって異なる値を返す
**構文**: `=IF(条件, 真の場合, 偽の場合)`
**出力タイプ**: 単一セル（任意の型）

**使用例**:
```excel
=IF(A1 >= 60, "合格", "不合格")
```
**出力結果** (A1=75の場合):
```
合格
```

**ネストの例**:
```excel
=IF(A1 >= 90, "優", IF(A1 >= 60, "良", "不可"))
```
**出力結果** (A1=85の場合):
```
良
```

---

### AND 🔷
**説明**: すべての条件が真の場合に真を返す
**構文**: `=AND(条件1, 条件2, ...)`
**出力タイプ**: 単一セル（真偽値）

**使用例**:
```excel
=AND(A1 >= 60, B1 >= 60, C1 >= 60)
```
**出力結果** (A1=70, B1=80, C1=55の場合):
```
FALSE
```
（C1が60未満のため）

---

### OR 🔷
**説明**: いずれかの条件が真の場合に真を返す
**構文**: `=OR(条件1, 条件2, ...)`
**出力タイプ**: 単一セル（真偽値）

**使用例**:
```excel
=OR(A1 = "営業部", A1 = "企画部")
```
**出力結果** (A1="営業部"の場合):
```
TRUE
```

---

### IFERROR 🔷
**説明**: エラーの場合に指定した値を返す
**構文**: `=IFERROR(値, エラー時の値)`
**出力タイプ**: 単一セル（任意の型）

**使用例**:
```excel
=IFERROR(A1/B1, "計算不可")
```
**出力結果** (B1=0の場合):
```
計算不可
```

---

### ISNUMBER 🔷
**説明**: 値が数値かどうかを判定
**構文**: `=ISNUMBER(値)`
**出力タイプ**: 単一セル（真偽値）

**使用例**:
```excel
=ISNUMBER("123")
```
**出力結果**:
```
TRUE
```

**使用例**:
```excel
=ISNUMBER("佐藤")
```
**出力結果**:
```
FALSE
```

---

## 3. 文字列関数

### CONCATENATE 🔷
**説明**: 複数の文字列を連結
**構文**: `=CONCATENATE(文字列1, 文字列2, ...)`
**出力タイプ**: 単一セル（文字列）

**使用例**:
```excel
=CONCATENATE("姓：", A1, " 名：", B1)
```
**出力結果** (A1="佐藤", B1="太郎"の場合):
```
姓：佐藤 名：太郎
```

---

### LEFT 🔷
**説明**: 文字列の左から指定文字数を抽出
**構文**: `=LEFT(文字列, 文字数)`
**出力タイプ**: 単一セル（文字列）

**使用例**:
```excel
=LEFT("佐藤 太郎", 2)
```
**出力結果**:
```
佐藤
```

---

### RIGHT 🔷
**説明**: 文字列の右から指定文字数を抽出
**構文**: `=RIGHT(文字列, 文字数)`
**出力タイプ**: 単一セル（文字列）

**使用例**:
```excel
=RIGHT("佐藤 太郎", 2)
```
**出力結果**:
```
太郎
```

---

### LEN 🔷
**説明**: 文字列の文字数を返す
**構文**: `=LEN(文字列)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=LEN("佐藤 太郎")
```
**出力結果**:
```
5
```
（スペースを含む5文字）

---

### SEARCH 🔷
**説明**: 文字列内で検索文字列の位置を返す（大文字小文字を区別しない）
**構文**: `=SEARCH(検索文字列, 対象文字列, [開始位置])`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=SEARCH("藤", "佐藤 太郎")
```
**出力結果**:
```
2
```
（2文字目に「藤」が見つかる）

**見つからない場合**:
```excel
=SEARCH("山田", "佐藤 太郎")
```
**出力結果**:
```
#ERROR: #VALUE!
```

---

## 4. 日付関数

### TODAY 🔷
**説明**: 今日の日付を返す
**構文**: `=TODAY()`
**出力タイプ**: 単一セル（日付文字列）

**使用例**:
```excel
=TODAY()
```
**出力結果**:
```
2026-01-30
```

---

### DATE 🔷
**説明**: 年月日から日付を作成
**構文**: `=DATE(年, 月, 日)`
**出力タイプ**: 単一セル（日付文字列）

**使用例**:
```excel
=DATE(2025, 12, 31)
```
**出力結果**:
```
2025-12-31
```

---

### YEAR 🔷
**説明**: 日付から年を抽出
**構文**: `=YEAR(日付)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=YEAR("2025-06-15")
```
**出力結果**:
```
2025
```

---

### MONTH 🔷
**説明**: 日付から月を抽出
**構文**: `=MONTH(日付)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=MONTH("2025-06-15")
```
**出力結果**:
```
6
```

---

### DAY 🔷
**説明**: 日付から日を抽出
**構文**: `=DAY(日付)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=DAY("2025-06-15")
```
**出力結果**:
```
15
```

---

### DATEDIF 🔷
**説明**: 2つの日付間の期間を計算
**構文**: `=DATEDIF(開始日, 終了日, 単位)`
**出力タイプ**: 単一セル（数値）

**単位**:
- `"Y"`: 年数
- `"M"`: 月数
- `"D"`: 日数

**使用例**:
```excel
=DATEDIF("2020-01-01", "2025-06-15", "Y")
```
**出力結果**:
```
5
```
（5年間）

**月数の例**:
```excel
=DATEDIF("2020-01-01", "2025-06-15", "M")
```
**出力結果**:
```
65
```
（65ヶ月）

---

## 5. 条件付き集計関数

### COUNTIF 🔷
**説明**: 条件に一致するセルの個数をカウント
**構文**: `=COUNTIF(範囲, 条件)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=COUNTIF(B:B, "*佐藤*")
```
**出力結果**:
```
50
```
（B列に「佐藤」を含むセルが50個）

**比較演算子の例**:
```excel
=COUNTIF(E:E, ">=2020")
```
**出力結果**: 2020年以降の個数（例: `125`）

---

### SUMIF 🔷
**説明**: 条件に一致するセルの合計を計算
**構文**: `=SUMIF(範囲, 条件, [合計範囲])`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=SUMIF(C:C, "営業部", D:D)
```
**出力結果**:
```
25000000
```
（C列が「営業部」の行のD列の合計）

---

### COUNTIFS 🔷
**説明**: 複数条件に一致するセルの個数をカウント
**構文**: `=COUNTIFS(範囲1, 条件1, 範囲2, 条件2, ...)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=COUNTIFS(C:C, "営業部", D:D, "課長")
```
**出力結果**:
```
15
```
（営業部かつ課長の個数）

---

### SUMIFS 🔷
**説明**: 複数条件に一致するセルの合計を計算
**構文**: `=SUMIFS(合計範囲, 範囲1, 条件1, 範囲2, 条件2, ...)`
**出力タイプ**: 単一セル（数値）

**使用例**:
```excel
=SUMIFS(E:E, C:C, "営業部", D:D, "課長")
```
**出力結果**:
```
5500000
```
（営業部かつ課長の売上合計）

---

## 6. 検索・参照関数

### VLOOKUP 🔷
**説明**: 縦方向の表から値を検索
**構文**: `=VLOOKUP(検索値, 範囲, 列番号, [完全一致])`
**出力タイプ**: 単一セル（任意の型）

**使用例**:
```excel
=VLOOKUP("037", A:E, 2, FALSE)
```
**出力結果**:
```
佐藤 誠
```
（ID "037" の氏名を取得）

**列番号の意味**:
- `1`: 1列目（検索列）
- `2`: 2列目（氏名）
- `3`: 3列目（部署）

---

### INDEX 🔷
**説明**: 配列から行列番号で値を取得
**構文**: `=INDEX(配列, 行番号, [列番号])`
**出力タイプ**: 単一セル（任意の型）

**使用例**:
```excel
=INDEX(A1:E10, 5, 2)
```
**出力結果**:
```
鈴木 花子
```
（5行目の2列目の値）

---

### MATCH 🔷
**説明**: 配列内で値の位置を検索
**構文**: `=MATCH(検索値, 配列, [照合タイプ])`
**出力タイプ**: 単一セル（数値）

**照合タイプ**:
- `0`: 完全一致
- `1`: 以下の最大値（昇順）
- `-1`: 以上の最小値（降順）

**使用例**:
```excel
=MATCH("佐藤 誠", B:B, 0)
```
**出力結果**:
```
38
```
（B列の38行目に「佐藤 誠」が見つかる）

---

## 7. 配列・フィルター関数

### FILTER 🔶
**説明**: 条件に一致する行を抽出
**構文**: `=FILTER(配列, 検索テキスト, 検索列)`
**出力タイプ**: 単一セル（複数行のデータを文字列化）

**⚠️ 重要**: 本来は複数セルにまたがる配列を返す関数ですが、現在の実装では読みやすい文字列形式に変換して**単一セルに表示**されます。

**使用例**:
```excel
=FILTER(A:E, "佐藤", B:B)
```
**出力結果**:
```
[結果: 50行]
037, 佐藤 誠, IT部, 係長, 2024
069, 佐藤 絢香, 営業部, 課長, 2024
104, 佐藤 里奈, 製造部, 課長, 2011
111, 佐藤 里奈, 製造部, 主任, 2016
131, 佐藤 花子, 企画部, 課長, 2015
...
（以下省略）
```

**部分一致検索**:
```excel
=FILTER(A:E, "営業", C:C)
```
**出力結果**: C列（部署）に「営業」を含む全行

---

## 8. デバッグ関数

### SHOWDATA 🔷
**説明**: データの内容を確認（デバッグ用）
**構文**: `=SHOWDATA(配列, [最大行数])`
**出力タイプ**: 単一セル（複数行のテキスト）

**使用例**:
```excel
=SHOWDATA(A:E, 10)
```
**出力結果**:
```
501行のデータ:
ID | 氏名 | 部署 | 役職 | 入社年
001 | 吉田 大樹 | 営業部 | 主任 | 2009
002 | 清水 さくら | 人事部 | 課長 | 2008
003 | 鈴木 陽子 | 製造部 | 係長 | 2019
004 | 加藤 愛 | 総務部 | 課長 | 2014
005 | 中村 拓也 | 経理部 | 部長 | 2024
006 | 清水 直樹 | 製造部 | 係長 | 2023
007 | 鈴木 健太 | 総務部 | 部長 | 2005
008 | 山田 隆 | 企画部 | 主任 | 2020
009 | 佐々木 麻衣 | 人事部 | 一般 | 2021
```

---

## 📊 出力タイプの詳細

### 🔷 単一セル出力（29関数）
結果が1つの値として1つのセルに表示されます。

**例**:
```
セル G1: =SUM(A1:A10)
結果: 5500
```

### 🔶 複数セル出力（2関数）

#### FILTER関数
本来は複数セルにまたがる結果を返す関数ですが、Handsontableの制約により、現在の実装では：

**変換前（本来の動作）**:
```
G1: 037    H1: 佐藤 誠    I1: IT部    ...
G2: 069    H2: 佐藤 絢香  I2: 営業部  ...
G3: 104    H3: 佐藤 里奈  I3: 製造部  ...
```

**変換後（現在の実装）**:
```
G1: [結果: 50行]
    037, 佐藤 誠, IT部, 係長, 2024
    069, 佐藤 絢香, 営業部, 課長, 2024
    104, 佐藤 里奈, 製造部, 課長, 2011
    ...
```

---

## 💡 実用的な組み合わせ例

### 例1: 営業部の課長の人数をカウント
```excel
=COUNTIFS(C:C, "営業部", D:D, "課長")
```
**出力**: `15`（単一セル）

### 例2: 2020年以降に入社した人を抽出
```excel
=FILTER(A:E, "202", E:E)
```
**出力**: 複数行のデータ（文字列化して単一セルに表示）

### 例3: 名前から部署を検索
```excel
=VLOOKUP("佐藤 誠", B:C, 2, FALSE)
```
**出力**: `IT部`（単一セル）

### 例4: 条件付きでメッセージを表示
```excel
=IF(COUNTIF(B:B, "*佐藤*") > 0, "佐藤さんがいます", "佐藤さんはいません")
```
**出力**: `佐藤さんがいます`（単一セル）

### 例5: エラーハンドリング付き検索
```excel
=IFERROR(VLOOKUP(A1, B:C, 2, FALSE), "見つかりません")
```
**出力**: 見つかった場合は値、エラーの場合は「見つかりません」（単一セル）

---

## ⚠️ 注意事項

### 配列数式について
Excel/Google Sheetsの標準的な配列数式（例: `{=FILTER(A:E, ISNUMBER(SEARCH("佐藤", B:B)))}`）は現在未対応です。

代わりに、簡易版の3引数形式を使用してください：
```excel
=FILTER(A:E, "佐藤", B:B)
```

### エラー表示
関数でエラーが発生した場合、以下の形式で表示されます：
```
#ERROR: エラーメッセージ
```

例:
- `#ERROR: FILTER: No results found`
- `#ERROR: #VALUE!`
- `#ERROR: Division by zero`

---

## 📝 まとめ

- **全31関数**を実装
- **29関数**が単一セル出力
- **2関数**（FILTER, SHOWDATA）が複数行テキスト出力（文字列化）
- Excel/Google Sheets互換の構文
- データ分析、集計、検索、条件判定など幅広い用途に対応

すべての関数はブラウザのコンソール（F12 → Console）でデバッグログを確認できます。
